esb-signHeaders
===============

Generates ESB signed headers for S2S Authentication based on the .pem file or private key. 
Reference: https://confluence.walmart.com/display/PGPSSO/Signing+headers+for+S2S+authentication

## Installing Package

 ```bash
 ## for node v0.10.x
 $ npm install @walmart/esb-signheaders@1.3.0

 ## for node v4.x.x
 $ npm install @walmart/esb-signheaders
 ```

## API Doc

### Options
 Following options are required for ESH to generate signed headers
 - `privateKey`: based 64 encoded string representation of private key
 - `pemFile` : absolute path for `*.pem` file containing formatted private key.
 - `algorithm`: Algorithm used for signing headers. Default `RSA-SHA256`
 - `encoding`: encoding for signature. Default `base64`

__Note__: set private key wither by passing as string using `privateKey` or setting the path for .pem file.

### ESB Headers
 __Note__: ESB Header names are case-sensitive.

 Following are mandatory headers required for generating auth signature

|Name|Description|
|---|---|
|`WM_CONSUMER.ID`|Valid Consumer UUID. Reference.|
|`WM_SEC.KEY_VERSION`|The version of the private-public key pair.|
|`WM_CONSUMER.INTIMESTAMP`|Timestamp in milliseconds since epoch. `optional` will generate one of not passed.|

Following headers will be added to result along with passed headers.

|Name|Description|
|---|---|
|`SignedHeaders`|It represents the keys that were signed and is in sorted order.|
|`WM_SEC.AUTH_SIGNATURE`|The signature value represented as base64 encoded string.|


### Usage

```javascript
    var options = {
        pemFilePath: Path.join(__dirname, 'privateKey.pem');
    }

    // Alternate is passing privateKey string
    /*
    var options = {
        privateKey: 'MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBAJWnEdvTo+VrPDkNv4C9ptqIrS+qIjawaRLkCiYX+LtI1Sw+XH7J8/o9KuAGwezoH+0XnQIJwOvE07TGvkWncnehBJwnToHsQXbzUlMrJQHG3+qgGkbbMQZRzrIqcEyEPGy/noKufJh3Z9srK5R8/0nVvjv0UT9XTM0EdcVp2a6rAgMBAAECgYBhbxYMhr3Fx8y85LuTKWcyDxya1O1TqAWxO/FzndXesevA05VLI1eKzDpXA29NPFBVADPEOO93UX34zBDjrsKyJj8nQHY/b6Sjkg852QH2wqKy9XJaf8Bss1K9uu8QEnfbFqUE3RhwrsKbk73EEzZqDHIydKEtAvGrFf5TBrZ4MQJBAPCNTAA8mMMMUDX4pZUEaMm1ePDkDCBzJ2iMkTnimuzVZ2pr430RvX2yvbv7IGMUozyajAfPB5Vp7u/Wrb9ahHkCQQCfQ2B/fwJqC64o+UB8q/7RWPGoE4uusd5ifCtPHZV0rT/pHO4TdxiVuKD2ijEUO2MEy8lemDoMbAs31koQIltDAkBDQQ31pvuC1Od8H3eT8Tam5oDYwLmPPQLQnTRhPbTY8FVIkL96kUIsaZPYgb6tVPDKmd76s+xH3uU50wiizljpAkBmSBYsK3x4cIHsLI9ewfMHrdCc+diGXBMPOuFxkPVQFofqBTtc4uq2FPnC++MjNDSWeu4bQzZcjfLybDvqerYTAkEAu4DXbuKqD6o5pl5nZRZmVhVkmLVDUTJ3oGaxe7n4YHFbQVpuTOtarP9ZSpCC82KNp876W7pQ2PoYvei+L3MGxA==';
    }
    */

    var headers = {
        'WM_SVC.NAME': 'services-name',
        'WM_SVC.VERSION': '1.0.0',
        'WM_SVC.ENV': 'dev',
        'WM_CONSUMER.ID': '11111111-1111-1111-1111-111111111111',
        'WM_CONSUMER.INTIMESTAMP': 1450496995352,
        'WM_SEC.KEY_VERSION': 1
    };

    var esh = new ESH(options);
    var signedHeaders = esh.sign(headers);

    console.log(signedHeaders)

    /*
    // output

    {
        'WM_SVC.NAME': 'services-name',
        'WM_SVC.VERSION': '1.0.0',
        'WM_SVC.ENV': 'dev',
        'WM_CONSUMER.ID': '11111111-1111-1111-1111-111111111111',
        'WM_CONSUMER.INTIMESTAMP': 1450496995352,
        'WM_SEC.KEY_VERSION': 1,
        SignedHeaders: 'WM_CONSUMER.ID;WM_CONSUMER.INTIMESTAMP;WM_SEC.KEY_VERSION;',
        'WM_SEC.AUTH_SIGNATURE': 'cUHZlNMe1pIiTbWemaYfG+fcOzuoJiXd/afSQgbsfIlNRixPzFpoM19c6QzEtd6FcR/JxZo3KvEWoSaJbHWyH1IeyzU/34+8CrQsurK5qrp/cIoawAS9AZrfWCtRiiaE+5avoZIi4Y4//62KWbsO4mNpN/4Gf62TeQMHJ+ebb8I='
    }
    */
```